<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AWS Progress Widget (Live)</title>
  <style>
    :root {
      --bg: #020617;
      --text-main: #e5e7eb;
      --text-sub: #9ca3af;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: transparent;
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 20px;
    }

    .widget-root {
      width: 100%;
      max-width: 820px;
      padding: 18px 20px;
      border-radius: 16px;
      background: radial-gradient(circle at top left, #0b1120 0, #020617 55%);
      box-shadow:
        0 18px 35px rgba(15, 23, 42, 0.8),
        0 0 0 1px rgba(148, 163, 184, 0.22);
    }

    .widget-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .widget-title { font-size: 1rem; font-weight: 600; }
    .widget-subtitle { font-size: .78rem; color: var(--text-sub); }

    /* ---------------- PROGRESS BAR ---------------- */

    .overall-progress-track {
      width: 100%;
      height: 22px;
      border-radius: 999px;
      background: #000; /* start color */
      overflow: hidden;
      box-shadow: inset 0 0 0 1px rgba(31, 41, 55, 0.95);
      margin-top: 4px;
    }

    .overall-progress-bar {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      transition:
        width .6s ease-out,
        background-color .6s ease-out;
    }

    .overall-progress-label {
      display: flex;
      justify-content: space-between;
      font-size: .8rem;
      color: var(--text-sub);
      margin-bottom: 6px;
    }

    .overall-progress-caption {
      font-size: .7rem;
      color: #6b7280;
      margin-top: 5px;
    }

    /* ---------------- TABLE ---------------- */

    .mini-table {
      margin-top: 12px;
      border-radius: 10px;
      overflow: hidden;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(31, 41, 55, 0.9);
    }

    table { width: 100%; border-collapse: collapse; font-size: .75rem; }

    th, td {
      padding: 8px 10px;
      border-bottom: 1px solid rgba(31, 41, 55, 0.9);
      white-space: nowrap;
    }

    th { color: var(--text-sub); font-weight: 500; }

    tbody tr:nth-child(even) { background: rgba(15, 23, 42, .85); }
    tbody tr:nth-child(odd) { background: rgba(15, 23, 42, .7); }
    tbody tr:hover { background: rgba(30, 64, 175, 0.45); }

    a { color: #38bdf8; text-decoration: none; }
    a:hover { text-decoration: underline; }

    .pill {
      padding: 3px 8px;
      border-radius: 999px;
      font-size: .7rem;
      border: 1px solid rgba(55,65,81,.9);
      display: inline-block;
    }

    .not-started { color: #9ca3af; }
    .in-progress { color: #fbbf24; border-color: rgba(251,191,36,.7); }
    .completed   { color: #4ade80; border-color: rgba(74,222,128,.7); }

    #errorMessage {
      font-size: .8rem;
      margin-top: 10px;
      color: #ff8b8b;
      display: none;
    }

  </style>
</head>
<body>
  <div class="widget-root">

    <!-- HEADER -->
    <div class="widget-header">
      <div class="widget-title">AWS Cloud Practitioner · 14-Day Plan</div>
      <div class="widget-subtitle">Live from Google Sheets</div>
    </div>

    <!-- PROGRESS BAR -->
    <div class="overall-progress-label">
      <span>Overall Progress</span>
      <span id="overallProgressText">0%</span>
    </div>

    <div class="overall-progress-track">
      <div id="overallProgressBar" class="overall-progress-bar"></div>
    </div>

    <div class="overall-progress-caption">
      Updates automatically when you edit your Google Sheet.
    </div>

    <!-- TABLE -->
    <div class="mini-table">
      <table>
        <thead>
          <tr>
            <th>Day</th>
            <th>Focus</th>
            <th>Time</th>
            <th>Resource</th>
            <th>Status</th>
            <th>Progress</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <!-- Filled from Google Sheets -->
        </tbody>
      </table>
    </div>

    <div id="errorMessage"></div>

  </div>

  <script>
    /* ---------------- GOOGLE SHEET CONFIG ---------------- */
    const SHEET_ID = "17HK_3Wthe0FZWTV8oKSiRNRAjtHVXSH92arqTl7qm9Y";  /* <= CHANGE THIS */
    const SHEET_NAME = "Plan";

    const SHEET_URL =
      "https://docs.google.com/spreadsheets/d/" +
      SHEET_ID +
      "/gviz/tq?sheet=" +
      encodeURIComponent(SHEET_NAME) +
      "&tqx=out:json";


    /* ---------------- HELPERS ---------------- */

    function parseSheetsJson(text) {
      const json = text.substring(text.indexOf("{"), text.lastIndexOf("}") + 1);
      return JSON.parse(json);
    }

    function toPercent(raw) {
      const m = String(raw).match(/(\d+)/);
      return m ? parseInt(m[1], 10) : 0;
    }

    function statusClass(s) {
      s = (s || "").toLowerCase();
      if (s.includes("completed")) return "completed";
      if (s.includes("progress")) return "in-progress";
      return "not-started";
    }

    /* ---------------- UPDATE PROGRESS BAR ---------------- */

    function updateProgressBar(overall) {
      const rounded = Math.round(overall);
      document.getElementById("overallProgressText").textContent = rounded + "%";

      const bar = document.getElementById("overallProgressBar");
      bar.style.width = rounded + "%";

      // Color: black (#000000) → mint (#C5FCFA)
      const t = overall / 100;
      const start = { r: 0, g: 0, b: 0 };
      const end   = { r: 197, g: 252, b: 250 };

      const r = Math.round(start.r + (end.r - start.r) * t);
      const g = Math.round(start.g + (end.g - start.g) * t);
      const b = Math.round(start.b + (end.b - start.b) * t);

      bar.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;
    }


    /* ---------------- LOAD SHEET ---------------- */

    async function loadSheet() {
      const tbody = document.getElementById("tableBody");
      const errorEl = document.getElementById("errorMessage");

      tbody.innerHTML = "";
      errorEl.style.display = "none";

      try {
        const res = await fetch(SHEET_URL);
        const text = await res.text();
        const data = parseSheetsJson(text);

        let total = 0, count = 0;

        data.table.rows.forEach(row => {
          const c = row.c;
          if (!c) return;

          const day = c[0]?.v || "";
          const focus = c[1]?.v || "";
          const time = c[2]?.v || "";
          const resLabel = c[3]?.v || "";
          const resLink  = c[4]?.v || "";
          const status = c[5]?.v || "Not Started";
          const progress = toPercent(c[6]?.v);

          total += progress;
          count++;

          const tr = document.createElement("tr");

          tr.innerHTML = `
            <td>${day}</td>
            <td>${focus}</td>
            <td>${time}</td>
            <td>${resLink ? `<a href="${resLink}" target="_blank">${resLabel}</a>` : resLabel}</td>
            <td><span class="pill ${statusClass(status)}">${status}</span></td>
            <td>${progress}%</td>
          `;

          tbody.appendChild(tr);
        });

        const avg = count ? total / count : 0;
        updateProgressBar(avg);

      } catch (err) {
        errorEl.textContent = "⚠ Could not load Google Sheet — check SHEET_ID, sheet name, and sharing (Anyone with link: Viewer).";
        errorEl.style.display = "block";
      }
    }

    loadSheet();
    setInterval(loadSheet, 60000); // auto-refresh
  </script>

</body>
</html>
